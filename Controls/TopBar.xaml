<UserControl x:Class="CeraRegularize.Controls.TopBar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="50" d:DesignWidth="400"
             x:Name="root">
    <!--
      TopBar replicates the menu-driven title bar from the PySide6 application.
      It exposes events for navigating to Home, Apply Leave, Configuration and
      Settings pages, and for closing the window. The menu button displays
      the user's initials and shows a colored border that reflects their
      current status (online, offline or unknown). A context menu pops up
      when clicking the menu button.
    -->
    <UserControl.Resources>
        <!-- Base style for round buttons -->
        <Style x:Key="CircleButtonStyle" TargetType="Button">
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="18"
                                Width="36" Height="36">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Menu button style: circular with accent background and dynamic border -->
        <Style x:Key="MenuButtonStyle" TargetType="Button" BasedOn="{StaticResource CircleButtonStyle}">
            <Setter Property="Background" Value="{DynamicResource AccentBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource AccentTextBrush}" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="BorderThickness" Value="2" />
        </Style>

        <!-- Close button style: circular red button with hover effect -->
        <Style x:Key="CloseButtonStyle" TargetType="Button" BasedOn="{StaticResource CircleButtonStyle}">
            <Setter Property="Background" Value="{DynamicResource DangerButtonBrush}" />
            <Setter Property="Foreground" Value="{DynamicResource DangerButtonTextBrush}" />
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontWeight" Value="Black" />
            <Setter Property="BorderThickness" Value="0" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{DynamicResource DangerButtonBorderBrush}" />
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    <Grid Background="{DynamicResource CardBackgroundBrush}" Height="54">
        <Grid.ColumnDefinitions>
            <!-- Left: menu button -->
            <ColumnDefinition Width="Auto" />
            <!-- Center: title -->
            <ColumnDefinition Width="*" />
            <!-- Right: close button -->
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <!-- Menu button with context menu -->
        <Button x:Name="MenuButton"
                Grid.Column="0"
                Style="{StaticResource MenuButtonStyle}"
                Content="{Binding Initials, ElementName=root}"
                BorderBrush="{Binding StatusBorderBrush, ElementName=root}"
                Click="MenuButton_Click"
                Margin="6,9,6,9">
            <Button.ContextMenu>
                <ContextMenu x:Name="Menu">
                    <MenuItem x:Name="LoginMenuItem" Header="Login" Click="LoginMenuItem_Click" Visibility="Collapsed" />
                    <MenuItem x:Name="HomeMenuItem" Header="Regularize Attendance" Click="HomeMenuItem_Click" />
                    <MenuItem x:Name="LeaveMenuItem" Header="Apply Leave" Click="LeaveMenuItem_Click" />
                    <MenuItem x:Name="ConfigMenuItem" Header="Configuration" Click="ConfigMenuItem_Click" />
                    <MenuItem x:Name="ProfileMenuItem" Header="Profile" Click="ProfileMenuItem_Click" Visibility="Collapsed" />
                    <MenuItem x:Name="SettingsMenuItem" Header="Settings" Click="SettingsMenuItem_Click" />
                </ContextMenu>
            </Button.ContextMenu>
        </Button>
        <!-- Title -->
        <TextBlock Grid.Column="1"
                   VerticalAlignment="Center"
                   HorizontalAlignment="Left"
                   FontWeight="Bold"
                   FontSize="18"
                   Foreground="{DynamicResource TextBrush}" Margin="97,0,0,0" ><Run FontSize="15.75" Text="CeraRegularize"/></TextBlock>
        <!-- Sync and close buttons -->
        <StackPanel Grid.Column="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right">
            <Button x:Name="SyncButton"
                    Style="{StaticResource SyncIconButtonStyle}"
                    Margin="0,9,6,9"
                    Click="SyncButton_Click" />
            <Button x:Name="CloseButton"
                    Style="{StaticResource CloseButtonStyle}"
                    Content="&#215;"
                    Click="CloseButton_Click"
                    Margin="0,9,6,9" RenderTransformOrigin="0.498,0.425" />
        </StackPanel>
    </Grid>
</UserControl>
